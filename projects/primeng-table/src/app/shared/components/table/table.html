<div class="bg-white border border-gray-200 rounded-lg shadow-sm dark:bg-gray-800 dark:border-gray-700 p-6">
  <p-table #dt [columns]="computedColumns()" [value]="computedRows()"
    [paginator]="withPaginator() && computedRows().length" [totalRecords]="totalCount()" [rows]="pageSize()"
    [first]="pageNumber()" [loading]="loading()" [lazy]="isLazy()" [showCurrentPageReport]="true"
    [(selection)]="selectedRows" [sortMode]="sortMode()" [rowsPerPageOptions]="rowsPerPageOptions()"
    [globalFilterFields]="globalFilterFields()" [currentPageReportTemplate]="currentPageReportTemplate()"
    (onPage)="pageChange($event)" (onSort)="onSort($event)" (onFilter)="onFilter($event)" dataKey="id"
    tableStyleClass="table-auto" columnResizeMode="expand" resizableColumns showGridlines rowHover>
    <ng-template #caption>
      <div class="flex justify-between">
        <div class="flex items-center gap-3">
          <p-button label="Clear" [outlined]="true" icon="pi pi-filter-slash" [disabled]="!filterInput.value"
            (click)="clearFilter(); filterInput.value = ''" />

          <ng-container [ngTemplateOutlet]="tableCaptionActionRef()" />
        </div>

        <p-iconfield iconPosition="left">
          <p-inputicon>
            <i class="pi pi-search"></i>
          </p-inputicon>

          <input #filterInput pInputText type="text" (input)="dt.filterGlobal($any($event.target).value, 'contains')"
            placeholder="Search keyword" />
        </p-iconfield>
      </div>
    </ng-template>

    <ng-template #header let-columns>
      <tr>
        @for (col of columns; track $index) {
        @if ($first && withSelection()) {
        <th><p-tableHeaderCheckbox /></th>
        }

        <th [pSortableColumn]="col.sortable && col.rowPropertyName" pResizableColumn
          [pResizableColumnDisabled]="!col.resizable">
          <div class="flex items-center gap-2">
            {{ col.title }}

            @if(col.sortable) {
            <p-sortIcon [field]="col.rowPropertyName" />
            }
          </div>
        </th>
        }

        <!-- Actions -->
        @if(tableActionRef()) {
        <th>
          <div class="flex items-center gap-2">
            Actions
          </div>
        </th>
        }
      </tr>

      @if (isFilterable()) {
      <tr>
        <th></th>

        @for (col of columns; track $index) {
        @if (col.filterable) {
        <th>
          @switch(col.filterType) {
          @case('text') {
          <p-columnFilter [field]="col.rowPropertyName" [showMenu]="false" class="min-width" ariaLabel="Filter Name">
            <ng-template #filter>
              <input pInputText type="text"
                (input)="dt.filter($any($event.target)?.value, col.rowPropertyName, 'contains')"
                placeholder="Type to search" />
            </ng-template>
          </p-columnFilter>
          }
          @case('select') {
          <p-columnFilter [field]="col.rowPropertyName" matchMode="equals" [showMenu]="false">
            <ng-template #filter let-filter="filterCallback">
              <p-select [options]="col.filterOptions()" (onChange)="filter($event.value)" class="min-width"
                placeholder="Select {{ col.title }}" [showClear]="true" optionLabel="label" appendTo="body">
                <ng-template let-option #item>
                  @if (col.filterOptionTemplate) {
                  <ng-container [ngTemplateOutlet]="col.filterOptionTemplate()"
                    [ngTemplateOutletContext]="{ $implicit: option }" />
                  } @else {
                  <span class="capitalize">{{ option.label }}</span>
                  }
                </ng-template>
              </p-select>
            </ng-template>
          </p-columnFilter>
          }
          @default {
          @if (col.filterCellTemplate) {
          <p-columnFilter [field]="col.rowPropertyName" [showMenu]="false" class="min-width" ariaLabel="Filter Name">
            <ng-template #filter let-filter="filterCallback">
              <ng-container [ngTemplateOutlet]="col.filterCellTemplate()" [ngTemplateOutletContext]="{ dt, col, filter }" />
            </ng-template>
          </p-columnFilter>
          }
          }
          }
        </th>
        } @else {
        <th></th>
        }
        }

        @if(tableActionRef()) {
        <th></th>
        }
      </tr>
      }
    </ng-template>

    <ng-template #body let-row let-columns="columns">
      <tr>
        @for (col of columns; track $index) {
        @if ($first && withSelection()) {
        <td>
          <p-tableCheckbox [value]="row" />
        </td>
        }

        <td [class]="col.customCellClass ? col.customCellClass(row) : ''">
          <span class="block truncate">
            @if(col.customCellTemplate) {
            <ng-container [ngTemplateOutlet]="col.customCellTemplate()"
              [ngTemplateOutletContext]="{ $implicit: row }" />
            } @else if(col.customCellComponent) {
            <ng-container [ngComponentOutlet]="col.customCellComponent" [ngComponentOutletInputs]="{ row }" />
            } @else {
            {{ col.customCellFormatter ? col.customCellFormatter(row) : getEachColumnData(row,
            col.rowPropertyName) }}
            }
          </span>
        </td>
        }

        <!-- Actions -->
        @if(tableActionRef()) {
        <td>
          <div class="flex items-center gap-2">
            <ng-container [ngTemplateOutlet]="tableActionRef()" [ngTemplateOutletContext]="{ $implicit: row }" />
          </div>
        </td>
        }
      </tr>
    </ng-template>
  </p-table>
</div>